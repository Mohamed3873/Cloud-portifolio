#!/bin/bash

# Directory where the repository will be cloned
REPO_DIR="/var/www/html/frontend"
GIT_URL="https://github.com/Mohamed3873/Cloud-portifolio.git"

# Check if the repository directory exists
if [ -d "$REPO_DIR" ]; then
    echo "Directory exists. Checking if it is a Git repository..."
    cd "$REPO_DIR"

    # Check if it's a git repository
    if [ -d ".git" ]; then
        echo "Git repository found. Pulling latest changes..."
        sudo git pull origin main
    else
        echo "Not a Git repository. Cloning repository..."
        sudo rm -rf "$REPO_DIR"  # Remove existing directory
        sudo git clone "$GIT_URL" "$REPO_DIR"
        cd "$REPO_DIR"
    fi
else
    echo "Directory does not exist. Cloning repository..."
    sudo git clone "$GIT_URL" "$REPO_DIR"
    cd "$REPO_DIR"
fi

# Ensure the correct path for index.html after pulling/cloning
INDEX_FILE="$REPO_DIR/src/main/frontend/index.html"

if [ -f "$INDEX_FILE" ]; then
    # Copy the index.html to the Apache document root
    echo "Copying index.html to Apache document root..."
    sudo cp "$INDEX_FILE" /var/www/html/

    # Set permissions for Apache to serve files
    sudo chown -R www-data:www-data /var/www/html
    sudo chmod -R 755 /var/www/html
else
    echo "Error: index.html not found in the repository"
fi

# Ensure Apache is running
sudo systemctl restart apache2
sudo systemctl enable apache2
